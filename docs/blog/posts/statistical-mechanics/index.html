<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yuxi Liu">
<meta name="dcterms.date" content="2024-07-01">

<title>Yuxi on the Wired - Statistical Mechanics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../img/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Yuxi on the Wired - Statistical Mechanics">
<meta property="og:description" content="Personal website of Yuxi Liu">
<meta property="og:image" content="https://yuxi-liu-wired.github.io/blog/posts/statistical-mechanics/img/blog icon.jpg">
<meta property="og:site_name" content="Yuxi on the Wired">
<meta name="twitter:title" content="Yuxi on the Wired - Statistical Mechanics">
<meta name="twitter:description" content="Personal website of Yuxi Liu">
<meta name="twitter:image" content="https://yuxi-liu-wired.github.io/blog/posts/statistical-mechanics/img/blog icon.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../img/favicon.ico" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Yuxi on the Wired</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../projects/index.qmd"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about/index.qmd"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://bair.berkeley.edu/"> <i class="bi bi-folder-symlink" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:yuxi.liu.1995@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Statistical Mechanics</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">math</div>
                <div class="quarto-category">physics</div>
                <div class="quarto-category">philosophy</div>
                <div class="quarto-category">probability</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Yuxi Liu </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 1, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">July 1, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#quick-reference" id="toc-quick-reference" class="nav-link" data-scroll-target="#quick-reference">Quick reference</a></li>
  </ul></li>
  <li><a href="#max-ent-statistical-mechanics" id="toc-max-ent-statistical-mechanics" class="nav-link" data-scroll-target="#max-ent-statistical-mechanics">Max-ent statistical mechanics</a></li>
  <li><a href="#using-the-partition-function" id="toc-using-the-partition-function" class="nav-link" data-scroll-target="#using-the-partition-function">Using the partition function</a></li>
  <li><a href="#free-entropies" id="toc-free-entropies" class="nav-link" data-scroll-target="#free-entropies">Free entropies</a></li>
  <li><a href="#conditional-entropies" id="toc-conditional-entropies" class="nav-link" data-scroll-target="#conditional-entropies">conditional entropies</a></li>
  <li><a href="#fluctuation-relations" id="toc-fluctuation-relations" class="nav-link" data-scroll-target="#fluctuation-relations">Fluctuation relations</a>
  <ul class="collapse">
  <li><a href="#fluctuation-of-observables" id="toc-fluctuation-of-observables" class="nav-link" data-scroll-target="#fluctuation-of-observables">Fluctuation of observables</a></li>
  <li><a href="#density-fluctuation-in-the-canonical-ensemble" id="toc-density-fluctuation-in-the-canonical-ensemble" class="nav-link" data-scroll-target="#density-fluctuation-in-the-canonical-ensemble">Density fluctuation in the canonical ensemble</a></li>
  </ul></li>
  <li><a href="#maximum-caliber-statistical-mechanics" id="toc-maximum-caliber-statistical-mechanics" class="nav-link" data-scroll-target="#maximum-caliber-statistical-mechanics">Maximum caliber statistical mechanics</a>
  <ul class="collapse">
  <li><a href="#markov-chains" id="toc-markov-chains" class="nav-link" data-scroll-target="#markov-chains">Markov chains</a></li>
  <li><a href="#diffusion" id="toc-diffusion" class="nav-link" data-scroll-target="#diffusion">diffusion</a></li>
  <li><a href="#fluctuation-dissipation-relations" id="toc-fluctuation-dissipation-relations" class="nav-link" data-scroll-target="#fluctuation-dissipation-relations">Fluctuation-dissipation relations</a></li>
  </ul></li>
  <li><a href="#crooks-fluctuation-theorem" id="toc-crooks-fluctuation-theorem" class="nav-link" data-scroll-target="#crooks-fluctuation-theorem">Crooks fluctuation theorem</a>
  <ul class="collapse">
  <li><a href="#in-a-closed-system-microcanonical" id="toc-in-a-closed-system-microcanonical" class="nav-link" data-scroll-target="#in-a-closed-system-microcanonical">In a closed system (microcanonical)</a></li>
  <li><a href="#in-an-energy-bath-canonical" id="toc-in-an-energy-bath-canonical" class="nav-link" data-scroll-target="#in-an-energy-bath-canonical">In an energy bath (canonical)</a></li>
  <li><a href="#other-ensembles" id="toc-other-ensembles" class="nav-link" data-scroll-target="#other-ensembles">Other ensembles</a></li>
  </ul></li>
  <li><a href="#jarzynski-equality" id="toc-jarzynski-equality" class="nav-link" data-scroll-target="#jarzynski-equality">Jarzynski equality</a>
  <ul class="collapse">
  <li><a href="#worked-example-bouncing-ball" id="toc-worked-example-bouncing-ball" class="nav-link" data-scroll-target="#worked-example-bouncing-ball">Worked example: bouncing ball</a></li>
  <li><a href="#fluctuation-dissipation-relations-1" id="toc-fluctuation-dissipation-relations-1" class="nav-link" data-scroll-target="#fluctuation-dissipation-relations-1">Fluctuation-dissipation relations</a></li>
  <li><a href="#arrow-of-time" id="toc-arrow-of-time" class="nav-link" data-scroll-target="#arrow-of-time">Arrow of time</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="quick-reference" class="level3">
<h3 class="anchored" data-anchor-id="quick-reference">Quick reference</h3>
<ul>
<li>Liouville’s theorem: Hamiltonian dynamics preserves density in phase space.</li>
</ul>
</section>
</section>
<section id="max-ent-statistical-mechanics" class="level2">
<h2 class="anchored" data-anchor-id="max-ent-statistical-mechanics">Max-ent statistical mechanics</h2>
<p>The idea of Gibbsian statistical mechanics is to study the evolution of an entire probability distribution over all possible states.</p>
<p>SETUP.</p>
<p>We have a state space <span class="math inline">\(X\)</span>, which by default is the phase space.</p>
<p>We study probability distributions (ensembles) over the state space.</p>
<p>The entropy of a probability distribution <span class="math inline">\(\rho\)</span> is <span class="math display">\[S[\rho] := -\int dx\; \rho(x) \ln \rho(x)\]</span></p>
<div id="prp-todo" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 1 (compound entropy)</strong></span> <span class="math inline">\(S_{X,Y} = S_Y + \braket{S_{X|y}}_y\)</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Consider a compound system in ensemble <span class="math inline">\(\rho(x, y)\)</span>. Its entropy is <span class="math display">\[S[\rho] = -\int dxdy \; \rho(x, y) \ln \rho(x, y)\]</span></p>
<p>We can take the calculation in two steps: <span class="math display">\[S[\rho] = -\int dxdy \; \rho(x|y)\rho(y) (\ln \rho(x|y) + \ln  \rho(y)) = S[\rho_Y] + \mathbb{E}_y[S[\rho_{X|y}]]\]</span></p>
<p>Here, <span class="math display">\[S[\rho_Y] = -\int dy \; \rho(y) \ln \rho(y)\]</span></p>
<p>is the entropy of system <span class="math inline">\(Y\)</span>,<br>
<span class="math display">\[S[\rho_{X | y}] = -\int dx \; \rho(x|y) \ln \rho(x|y)\]</span></p>
<p>is the entropy of system <span class="math inline">\(X\)</span> conditional on the state of system <span class="math inline">\(Y\)</span> being equal to <span class="math inline">\(y\)</span>, and<br>
<span class="math display">\[\mathbb{E}_y\]</span></p>
<p>means taking expectation over the state of system <span class="math inline">\(Y\)</span>.</p>
<p>More succinctly, <span class="math inline">\(S_{X,Y} = S_Y + \braket{S_{X|y}}_y\)</span>.</p>
</div>
<p>ASSM. (maximum entropy distribution under constraint)</p>
<p>In most systems, everything measurable can be found by studying it as if it has the maximum entropy distribution under constraint.</p>
<section id="differential-entropy-depends-on-coordinates-choice" class="level4">
<h4 class="anchored" data-anchor-id="differential-entropy-depends-on-coordinates-choice">Differential entropy depends on coordinates choice</h4>
<p>Consider the uniform distribution on <span class="math inline">\([0, 1]\)</span>. It is the maxent distribution on <span class="math inline">\([0, 1]\)</span>… relative to the Lebesgue measure.</p>
<p>Suppose we now stretch the <span class="math inline">\([0, 1]\)</span> interval nonlinearly, by <span class="math inline">\(f(x) = x^2\)</span>, then the maxent distribution relative to <em>that</em> would no longer be the uniform distribution on <span class="math inline">\([0, 1]\)</span>. Instead, it would be the uniform distribution after stretching.</p>
<p>The problem is essentially this: if we change the coordinates, we change the base measure, and the differential entropy changes.</p>
<p>To fix this, we can use the KL-divergence, which is invariant under a change of base measure, as in <span class="math display">\[-D_{KL}(\rho \| \mu) := - \int dx\; \rho(x) \ln\frac{\rho(x)}{\mu(x)}\]</span></p>
<p>In typical situations, we don’t need to worry ourselves with KL-divergence, as we just pick the uniform distribution <span class="math inline">\(\mu\)</span>. When the state space is infinite in volume, the uniform distribution is not a probability measure, but it will work. Bayesians say that it is an <em>improper prior</em>.</p>
<p>In this interpretation, the principle of “maximum entropy distribution under constraint” becomes the principle of “minimal KL-divergence under constraint”, which <em>is</em> Bayesian inference, with exactly the same formulas.</p>
<p>In almost all cases, we use the uniform prior over phase space. This is how Gibbs did it, and he didn’t really justify it other than saying that <em>it just works</em>, and suggesting it has something to do with Liouville’s theorem. Now with a century of hindsight, we know that it works because of quantum mechanics: we should use the uniform prior over phase space, because phase space volumes have a natural unit of measurement: <span class="math inline">\(h\)</span>, Planck’s constant. Planck’s constant is a universal constant, so we should weight all of the phase space equally, giving a uniform prior.</p>
<p>DEF. extensivity</p>
<p>In classical thermodynamics, extensivity means that entropy of the compound system can be calculated in a two-step process: calculate the entropy of each subsystem, then add them up. The important fact is that a subsystem still has enough independence to have its own entropy.</p>
<p>This is not always obvious. If we have two galaxies of stars, we can think of each as a “cosmic gas” where each particle is a star. Now, if we put them near each other, then the gravity between the two galaxies would mean it is no longer meaningful to speak of “the entropy of galaxy 1”, but only “the entropy of galaxy-compound 1-2”.</p>
<p>In statistical mechanics, extensivity <em>usually</em> means the Hamiltonian of each subsystem is unaffected by the state of the other subsystems, and the total Hamiltonian is the sum of all the Hamiltonians. However, other definitions exist.</p>
<p>SETUP. the microcanonical ensemble</p>
<p>If the only constraint is the energy <span class="math inline">\(E\)</span>, then the maximal entropy distribution is the uniform distribution on the shell of constant energy <span class="math inline">\(H = E\)</span>. This is the <strong>microcanonical ensemble</strong>:</p>
<p><span class="math display">\[\rho_E(x) \propto 1_{H(x) = E}\]</span></p>
<p>If we have a small system connected to a large system, then we typically don’t care about the large system, and only want to study the ensemble of the small system. In this case, we would first find the microcanonical ensemble for the total system, then integrate out of the large system, resulting in an ensemble over just the small system, like</p>
<p><span class="math display">\[\rho_{small}(x) = \int \rho_{total}(x, y) dy\]</span></p>
<p>where <span class="math inline">\(x\)</span> ranges over the state of the small system, and <span class="math inline">\(y\)</span> that of the large system.</p>
<p>If we further assume that the compound system is extensive, then we can derive all the other ensembles – canonical, grand canonical, etc – depending on how the two systems are connected.</p>
<p>In the following theorem, we assume that the total system is extensive, and is already in the maximal entropy distribution (microcanonical ensemble). We derive the distribution of the small system by marginalizing out the large system.</p>
<div id="prp-todo" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 2 (Entropy is preserved in Hamiltonian systems)</strong></span> If a system is a Hamiltonian system with any Hamiltonian (which can change with time), then for any probability distribution <span class="math inline">\(\rho\)</span> over its phase space, its entropy is conserved over time.</p>
<p>The microcanonical ensemble is the unique maximizer of entropy under the constraint of constant energy.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>The first result is by Liouville’s theorem.</p>
<p>Let <span class="math inline">\(\rho\)</span> be the microcanonical distribution on the energy shell of <span class="math inline">\(H = E\)</span>. Given any other distribution <span class="math inline">\(\rho'\)</span>, we have <span class="math display">\[S[\rho'] = S[\rho] - D_{KL}(\rho' \| \rho)\]</span></p>
<p>which is maximized at only <span class="math inline">\(\rho' = \rho\)</span>.</p>
</div>
<div id="cor-todo" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 1</strong></span> Constrained maxent distributions are preserved in Hamiltonian systems</p>
<p>That is, given any set of constraints, if the Hamiltonian preserves these constraints over time, then any maximal entropy distribution satisfying those constraints is preserved by time-evolution under the Hamiltonian. In particular, if the Hamiltonian is constant over time, then any microcanonical ensemble is preserved by time-evolution.</p>
</div>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1 (Canonical ensembles)</strong></span> If the two systems are in energy-contact, then the small system has the <strong>canonical ensemble</strong></p>
<p><span class="math display">\[
\rho(x) \propto e^{-\beta H(x)}
\]</span></p>
<p>where <span class="math inline">\(\beta\)</span> is the marginal entropy of energy of the large system:</p>
<p><span class="math display">\[\beta := \partial_E S[\rho_{bath, E}]\]</span></p>
</div>
<p>Similarly, if the two systems are in energy-and-particle-contact, then the small system has the <strong>grand canonical ensemble</strong></p>
<p><span class="math display">\[
\rho(x) \propto e^{-(\beta H(x) + (-\beta \mu) N(x))}
\]</span></p>
<p>where <span class="math inline">\(-\beta\mu\)</span> is the marginal entropy of particle of the large system:</p>
<p><span class="math display">\[-\beta\mu := (\partial_N S[\rho_{bath, E, N}])_{E}\]</span></p>
<p>More generally, if the two systems are in <span class="math inline">\(q_1, \dots, q_m\)</span> contact, then <span class="math display">\[\rho(x) \propto e^{-\sum_i p_i q_i(x)}\]</span></p>
<p>where <span class="math inline">\(p_i = (\partial_{q_i} S[\rho_{bath, q}])_{q}\)</span> is the marginal entropy for conserved quantity <span class="math inline">\(q_i\)</span>.</p>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>We prove the case for the energy-contact. The other cases are similar.</p>
<p>Since the total distribution of the whole system is the maximal entropy distribution, we are faced with a constrained maximization problem:</p>
<p><span class="math display">\[\max_\rho S[\rho]\]</span></p>
<p>The entropy of the compound system satisfies</p>
<p><span class="math display">\[S = S_{system} + \braket{S_{bath|system}}_{system}\]</span></p>
<p>Since the bath is so much larger than the system, we can take just the first Taylor expansion:</p>
<p><span class="math display">\[S_{bath|system} = S_{bath}(E) - \beta E_{system}\]</span></p>
<p>where <span class="math inline">\(E\)</span> is the total energy, and <span class="math inline">\(E_{system}\)</span> is the energy of the system.</p>
<p>This gives us the constraint maximization problem of</p>
<p><span class="math display">\[\max (S_{system} - \beta \braket{E_{system}})\]</span></p>
<p>This is the statistical mechanics analog of the “maximize Helmholtz free entropy” problem.</p>
<p>In detail, we have a problem of variational calculus: <span class="math display">\[
\begin{cases}
  \min\int dx\; &amp;\rho(x)(\ln\rho(x) + \beta E_{system}(x)) \\
      \int dx\; &amp;\rho (x) = 1
\end{cases}
\]</span></p>
<p>which by using the Lagrange multiplier, gives us the solution.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Alternatively, we don’t need the Lagrange multiplier. <strong>Define</strong> the Boltzmann distribution as</p>
<p><span class="math display">\[\rho_B(x) = Z(\beta)^{-1} e^{-\beta E_{system}(x)}\]</span></p>
<p>where <span class="math inline">\(Z(\beta)\)</span> is the normalization constant (partition function), defined by<br>
<span class="math display">\[Z(\beta) = \int dx\; e^{-\beta E_{system}(x)}\]</span></p>
<p>It remains to prove that <span class="math inline">\(\rho = \rho_B\)</span>.</p>
<p>By routine calculation, the optimization problem is equivalent to</p>
<p><span class="math display">\[
\min \left(\int dx\; \rho(x) \ln\frac{\rho(x)}{\rho_B(x)} - \ln Z(\beta)\right)
\]</span></p>
<p>and since <span class="math inline">\(Z(\beta)\)</span> is independent of <span class="math inline">\(\rho\)</span>, we just need to solve</p>
<p><span class="math display">\[
\min \int dx\; \rho(x) \ln\frac{\rho(x)}{\rho_B(x)} = \min D_{KL}(\rho \| \rho_B)
\]</span> which is just the KL-divergence, and is minimized exactly at <span class="math inline">\(\rho = \rho_B\)</span>.</p>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="extensivity">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
extensivity
</div>
</div>
<div class="callout-body-container callout-body">
<p>Extensivitiy in statistical mechanics yields extensivity in thermodynamics. Specifically, writing <span class="math inline">\(S_{bath}(E)\)</span>, instead of <span class="math inline">\(S_{bath}(E, E_{system})\)</span>, requires the assumption of extensivity. Precisely because the bath and the system do not affect each other, we are allowed to calculate the entropy of the bath without knowing anything about the energy of the system.</p>
<p><span class="math inline">\(S_{bath}\)</span> is the logarithm of the surface area of the energy shell <span class="math inline">\(H_{bath} = E_{bath}\)</span>. By extensivity, <span class="math inline">\(H(x_{bath}, x_{system}) = H_{bath}(x_{bath}) + H_{system}(x_{system})\)</span>, so the energy shells of the bath depends on only <span class="math inline">\(E_{bath}\)</span>, not <span class="math inline">\(E_{system}\)</span>.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The proof showed something extra: If the small system is in distribution <span class="math inline">\(\rho\)</span> that does not equal to the equilibrium distribution <span class="math inline">\(\rho_B\)</span>, then the total system’s entropy is</p>
<p><span class="math display">\[S = S_{max} - D_{KL}(\rho \| \rho_B)\]</span></p>
<p>which reminds me of Sanov theorem and large deviation theory…</p>
</div>
</div>
<p>EXR. Try deriving some other ensembles.</p>
<p>For example, what if we have a system in volume-contact, but not thermal-contact? This might happen when the system is a flexible bag of gas held in an atmosphere, but the bag is made of thermally insulation. Notice that in this case, energy exchange still occurs, so you should solve</p>
<p>As another example, what if we have a system in particle-contact, but not energy-contact? I don’t know when this might happen, but it could happen!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In statistics, such ensemble are called <strong>exponential families</strong>, so we can abstractly describe this as follows:</p>
<p>If a small system is in contact with a large system, and the total system is in the microcanonical ensemble, then the marginal distribution of the small system is a distribution from an exponential family.</p>
</div>
</div>
</section>
</section>
<section id="using-the-partition-function" class="level2">
<h2 class="anchored" data-anchor-id="using-the-partition-function">Using the partition function</h2>
<p>DEF. Let <span class="math inline">\(Z = \int dx\; e^{-\beta E(x)}\)</span> be the partition function, and let <span class="math inline">\(f^* := \ln Z\)</span>.</p>
<p><span class="math inline">\(Z\)</span> is a function of <span class="math inline">\(\beta\)</span>, and other possible constraints that might directly change the energy levels of the system. We can more explicitly write it as <span class="math display">\[Z(\beta; c) = \int dx \; e^{-\beta E_c(x)}\]</span></p>
<p>where <span class="math inline">\(c\)</span> stands for the other constraints on the system, such as the size of the container, the number of particles, etc.</p>
<div id="prp-todo" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 3 (The partition function generates all moments of energy)</strong></span> Let a system be in canonical ensemble with inverse temperature <span class="math inline">\(\beta\)</span>, and let <span class="math inline">\(K(t) := \ln \braket{e^{tE}}\)</span> be the cumulant generating function of its energy, then <span class="math display">\[K(t) = \ln Z(\beta-t) - \ln Z(\beta)\]</span></p>
<p>In particular, the <span class="math inline">\(n\)</span>-th cumulant of energy is<br>
<span class="math display">\[\kappa_n(E) = K^{(n)}(t) |_{t=0} = (-\partial_\beta)^n (\ln Z)\]</span></p>
<p>For example, the first two cumulants are the mean and variance: <span class="math display">\[\braket{E} = (-\partial_\beta) (\ln Z), \quad \mathrm{Var}(E) = \partial_\beta^2 (\ln Z)\]</span></p>
</div>
<p>In typical systems made of <span class="math inline">\(N\)</span> particles, where <span class="math inline">\(N\)</span> is large, we have <span class="math inline">\(\ln Z \propto N\)</span>, thus showing that <span class="math inline">\(\sqrt{\mathrm{Var}(E)}/\braket{E} \propto N^{-1/2}\)</span>, meaning that the distribution of energy converges to the average value as <span class="math inline">\(N \to \infty\)</span>.</p>
<p>A similar proposition applies for the grand canonical ensemble, etc.</p>
</section>
<section id="free-entropies" class="level2">
<h2 class="anchored" data-anchor-id="free-entropies">Free entropies</h2>
<p>In the above, the only constraint we have imposed is constant energy, yielding the microcanonical ensemble. We can allow more constraints, yielding the fully general Gibbsian statistical mechanics.</p>
<p>A common trick in statistical mechanics is to characterize the same equilibrium in many different perspectives. For example, the canonical ensemble has three characterizations at least.</p>
<p>SETUP.</p>
<p>We have a state space <span class="math inline">\(X\)</span>, and probability distributions <span class="math inline">\(\rho\)</span> over <span class="math inline">\(X\)</span>.</p>
<p>Macroscopic observables <span class="math inline">\(A, B, C, \dots\)</span> are functions of type <span class="math inline">\(X \to \mathbb{R}\)</span>.</p>
<p>A constraint can be an equality or inequality on observables. For example, if we have a tube of jelly in a box of volume <span class="math inline">\(10\)</span>, then the constraint is <span class="math inline">\(0 \leq V(x) \leq 10\)</span>.</p>
<p>A constraint can also be an equality or inequality on the distribution. For example, we can specify that the average energy is exactly 1, by <span class="math display">\[\int dx\; \rho(x) E(x) = 1\]</span></p>
<p>The equilibrium distribution under constraint is the maximal entropy distribution satisfying the constraints.</p>
<p>DEF. (free entropies)</p>
<p>Just like in thermodynamics, we can take convex duals of the entropy function, to obtain various free entropies.</p>
<p>Helmholtz free entropy: <span class="math display">\[f[\rho] := S[\rho] - \beta \braket{E} = \int dx \; \rho(x) (-\ln \rho(x) - \beta E(x))\]</span></p>
<p>Gibbs free entropy: <span class="math display">\[g[\rho] = S[\rho] - \beta \braket{E} - \beta P \braket{V}\]</span></p>
<p>And similarly for others.</p>
<div id="prp-todo" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 4 (The chain rule for free entropies)</strong></span> <span class="math inline">\(f_X = S_Y + \braket{f_{X|y}}_y\)</span>, and similarly <span class="math inline">\(g_X = S_Y + \braket{g_{X|y}}_y\)</span>, and similarly for all other convex duals of the entropy.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
  f_X &amp;= S_X - \beta \braket{E}_x  \\
  &amp;= S_Y + \braket{S_{X|y}}_y - \beta \braket{\braket{E}_{x \sim X|y}}_y \\
  &amp;= S_Y + \braket{f_{X|y}}_y
\end{aligned}
\]</span></p>
</div>
<div id="prp-todo" class="theorem proposition">
<p><span class="theorem-title"><strong>Proposition 5 (4 characterizations of the canonical ensemble)</strong></span> &nbsp;</p>
<ol type="1">
<li>(total entropy under fixed energy constraint) The canonical ensemble maximizes total entropy when the system is in contact with an energy bath that satisfies <span class="math inline">\(\partial_E S_{bath} = \beta\)</span>, and the total energy is fixed.</li>
<li>(entropy under mean energy constraint) A system maximizes its entropy under constraint <span class="math inline">\(\braket{E} = E_0\)</span> when it assumes the canonical ensemble with <span class="math inline">\(\beta\)</span> that is the unique solution to <span class="math inline">\(\int dx \; e^{-\beta E(x)} = E_0\)</span>.</li>
<li>(thermodynamic limit): Take <span class="math inline">\(N\)</span> copies of a system, and connect them by energy-contacts. Inject the system with total energy <span class="math inline">\(NE_0\)</span>, and let the system reach its microcanonical ensemble. Then at the thermodynamic limit of <span class="math inline">\(N\to \infty\)</span>, the distribution of a single system is the canonical distribution with <span class="math inline">\(\beta\)</span> that is the unique solution to <span class="math inline">\(\int dx \; e^{-\beta E(x)} = E_0\)</span>.</li>
<li>(free entropy) A system maximizes its Helmholtz free entropy when it assumes the canonical ensemble. At that point, the maximal Helmholtz free entropy is <span class="math inline">\(f^* = \ln Z\)</span>, where <span class="math inline">\(Z = \int dx \; e^{-\beta E(x)}\)</span> is the partition function.</li>
</ol>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span></p>
<ol type="1">
<li>We already proved this.</li>
<li>Use the Lagrange multiplier.</li>
<li>Isolate one system, and treat the rest as an energy-bath.</li>
<li><span class="math inline">\(f[\rho] = \ln Z - D_{KL}(\rho \| \rho_B)\)</span>.</li>
</ol>
</div>
</section>
<section id="conditional-entropies" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="conditional-entropies">conditional entropies</h2>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2 (conditional entropy)</strong></span> Given any random variable <span class="math inline">\(X\)</span>, and an “observable” variable <span class="math inline">\(Y\)</span> that is determined by <span class="math inline">\(X\)</span>, if <span class="math inline">\(X\)</span> is the maximal entropy distribution under constraint with entropy <span class="math inline">\(S_X^*\)</span>, then the observable <span class="math inline">\(Y\)</span> follows a Boltzmann distribution, as <span class="math display">\[\rho_Y^*(y) = e^{S_{X|y}^* - S_X^*}\]</span></p>
<p>where <span class="math inline">\(S_{X|y}^*\)</span> is the maximal entropy for <span class="math inline">\(X\)</span> conditional on the same constraints, plus the constraint that <span class="math inline">\(Y = y\)</span>.</p>
<p>Furthermore, <span class="math display">\[e^{S_X^*} = \int dy\; e^{S_{X|y}^*}\]</span></p>
</div>
<div class="proof page-columns page-full">
<p><span class="proof-title"><em>Proof</em>. </span>By assumption, <span class="math inline">\(X\)</span> is the unique solution to the constrained optimization problem</p>
<p><span class="math display">\[
\begin{cases}
    \max S_X \\
    \text{constraints on $x$}
\end{cases}
\]</span></p>
<p>Because <span class="math inline">\(S_X = S_Y + \braket{S_{X|y}}_{y \sim Y}\)</span>, we realize that solving that <em>one</em> constrained optimization problem is really solving an entire family of constrained optimization problems. In particular, it also solves the problem</p>
<p><span class="math display">\[
\begin{cases}
    \max S_Y + \braket{S_{X|y}}_{y\sim Y} \\
    \text{constraints on $x$}
\end{cases}
\]</span></p>
<p>Now, we can solve the original problem in a two-step process: For each possible observable <span class="math inline">\(y\sim Y\)</span>, we solve an extra-constrained problem:</p>
<p><span class="math display">\[
\begin{cases}
    \max S_{X|y} \\
    \text{original constraints on $x$} \\
    \text{$x$ must be chosen such that the observable $Y = y$}
\end{cases}
\]</span></p>
<p>Then, each such problem gives us a maximal conditional<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> entropy <span class="math inline">\(S_{X|y}^*\)</span>, and we can solve for <span class="math inline">\(Y\)</span> by</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;If you’re a pure mathematician, you can formalize this using <a href="https://en.wikipedia.org/wiki/Disintegration_theorem">measure disintegration</a>.</p></div></div><p><span class="math display">\[\max(S_Y + \braket{S_{X|y}^*}_{y \sim Y})\]</span></p>
<p>Again, the solution is immediate once we see it is just the KL-divergence:</p>
<p><span class="math display">\[S_Y + \braket{S_{X|y}^*}_{y \sim Y} = - \int dy \; \rho_Y(y) \ln\frac{\rho_Y(y)}{e^{S_{X|y}^*}} = \ln Z - D_{KL}(\rho_Y \| \rho_Y^*)\]</span></p>
<p>where</p>
<p><span class="math display">\[Z = \int dy\; e^{S_{X|y}^*}, \quad \rho_Y^*(y) = \frac{e^{S_{X|y}^*}}{Z}\]</span></p>
<p>At the optimal point, the entropy for <span class="math inline">\(X\)</span> is maximized at <span class="math inline">\(S_X^* = \ln Z - 0\)</span>, so <span class="math inline">\(Z = e^{S_X^*}\)</span>.</p>
</div>
<p>EXP. the canonical ensemble again</p>
<p>Consider a small system with energy states <span class="math inline">\(E_1, E_2, \dots\)</span> and a large bath system, in energy contact. We can set <span class="math inline">\(X\)</span> to be the combined state of the whole system, and <span class="math inline">\(Y\)</span> to be the state of the small system.</p>
<p>Once we observe <span class="math inline">\(y\)</span>, we have fully determined the small system, so the small system has zero entropy, and so all the entropy comes from the bath system: <span class="math display">\[S_{X|y}^* = S_{bath} = S_{bath}(E_{total}) - \beta E_y\]</span></p>
<p>Consequently, the distribution of the small system is <span class="math display">\[\rho_Y(y) \propto e^{-\beta E_y}\]</span></p>
<p>which is the Boltzmann distribution, as expected.</p>
<p>Similar calculation gives us the grand canonical ensemble, etc.</p>
<p>The above theorem can be generalized to conditional free entropies.</p>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3 (conditional free entropy)</strong></span> Given any random variable <span class="math inline">\(X\)</span>, and an “observable” variable <span class="math inline">\(Y\)</span> that is determined by <span class="math inline">\(X\)</span>, if <span class="math inline">\(X\)</span> is the distribution that maximizes Helmholtz free entropy under constraint with Helmholtz free entropy <span class="math inline">\(f_X^*\)</span>, then the observable <span class="math inline">\(Y\)</span> is distributed as <span class="math display">\[\rho_Y^*(y) = e^{f_{X|y}^* - f_X^*}\]</span></p>
<p>where <span class="math inline">\(f_{X|y}^*\)</span> is the maximal Helmholtz free entropy for <span class="math inline">\(X\)</span> conditional on the same constraints, plus the constraint that <span class="math inline">\(Y = y\)</span>.</p>
<p>Furthermore, <span class="math display">\[e^{f_X^*} = \int dy\; e^{f_{X|y}^*}\]</span></p>
<p>Similarly for Gibbs free entropy, and all other free entropies.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>First note that <span class="math inline">\(f_X = S_Y + \braket{f_{X|y}}_y\)</span>. Then we proceed to argue in the same way.</p>
</div>
</section>
<section id="fluctuation-relations" class="level2">
<h2 class="anchored" data-anchor-id="fluctuation-relations">Fluctuation relations</h2>
<section id="fluctuation-of-observables" class="level3">
<h3 class="anchored" data-anchor-id="fluctuation-of-observables">Fluctuation of observables</h3>
<p>Suppose we have a tank of oxygen gas, and it is in the equilibrium distribution (Maxwell-Boltzmann). Now, if we sample its pressure <span class="math inline">\(P\)</span>, then every time we sample it, we sample a particular microstate <span class="math inline">\(x\)</span> from its equilibrium distribution, and each corresponds to a different pressure <span class="math inline">\(P(x)\)</span>. We know that these particular pressures should be tightly bunched around its average value – the thermodynamic pressure <span class="math inline">\(\braket{P}\)</span>… but how bunched-up is it?</p>
<p>More generally, suppose we have a system in the equilibrium state (maximal entropy under constraint), how much fluctuation does it have?</p>
<p>EXP. systems in energy-contact, the zeroth law</p>
<p>Take several systems, and let them exchange energy, but nothing else. For concreteness, we can imagine taking several copper tanks of gas, and let them touch each other. The tanks hold their shape, not expanding or contracting.</p>
<p>The system has total entropy <span class="math display">\[S = \sum_i S_i(E_i, A_i)\]</span></p>
<p>where <span class="math inline">\(A_i\)</span> stand for the other state variables we don’t care about, because they are held constant</p>
<p>There is a single constraint of constant total energy: <span class="math display">\[E = \sum_i E_i\]</span></p>
<p>In the thermodynamical limit, the compound system reaches the maximal entropy state <span class="math inline">\(E_1^*, \dots, E_n^*\)</span>, which solves the following constrained maximization <span class="math display">\[\begin{cases}
    \max \sum_i S_i(E_i, A_i)\\
    E = \sum_i E_i
\end{cases}\]</span></p>
<p>By calculus, at the optimal point, all systems satisfy</p>
<p><span class="math display">\[
(\partial_{E_i} S_i)_{A_i} = \beta
\]</span></p>
<p>for some number <span class="math inline">\(\beta\)</span>. This is the zeroth law of thermodynamics.</p>
<p>DER.</p>
<p>However, we are in statistical mechanics, so the compound system actually does not stay exactly at the optimal point. Instead, the energy levels fluctuate.</p>
<p>Let us write the fluctuation vector as</p>
<p><span class="math display">\[Y = (\Delta E_1, \dots, \Delta E_n)\]</span></p>
<p>which satisfies the constraint <span class="math inline">\(\sum_i \Delta E_i = 0\)</span>.</p>
<p>Let the fluctuation vector be the observable. As proved previously, the fluctuation satisfies</p>
<p><span class="math display">\[\rho_Y(y) \propto e^{S^*_{X|y}}\]</span></p>
<p>where <span class="math inline">\(S^*_{X|y}\)</span> is the entropy of the compound system, given <span class="math inline">\(Y = y\)</span>. For small fluctuations, this is just:</p>
<p><span class="math display">\[S^*_{X|y} = \sum_i S_i(E_i^*) + (\partial_{E_i} S_i)_{A_i} \Delta E_i + \frac 12 (\partial_{E_i}^2 S_i)_{A_i} (\Delta E_i)^2 + \cdots\]</span></p>
<p>Since <span class="math inline">\(\sum_i \Delta E_i = 0\)</span>, this just gives</p>
<p><span class="math display">\[\rho_Y(y) \propto e^{\sum_i \frac 12 (\partial_{E_i}^2 S_i)_{A_i} (\Delta E_i)^2}\]</span></p>
<p>Now, <span class="math inline">\(\partial_E S = \beta\)</span>, and <span class="math inline">\(\partial_E^2 S = -\frac{1}{T^2 C}\)</span> in typical thermodynamic notation, where <span class="math inline">\(C\)</span> is <span class="math inline">\(\partial_T E\)</span>, the heat capacity (holding all other variables <span class="math inline">\(A\)</span> constant).</p>
<p>In particular, for gases, it is</p>
<p><span class="math display">\[\rho_Y(y) \propto e^{-\sum_i \frac{1}{2T^2 C_{V, i}} (\Delta E_i)^2}\]</span></p>
<p>where <span class="math inline">\(C_{V, i}\)</span> is the constant-volume heat capacity of the <span class="math inline">\(i\)</span> -th gas.</p>
<p>In particular, if we have monoatomic ideal gas, with <span class="math inline">\(C_V = \frac 32 N\)</span>, then the size of a typical fluctuation is on the order of</p>
<p><span class="math display">\[\sim\sqrt N T \sim N^{-1/2} E^*\]</span></p>
<p>That is, a typical fluctuation energy is only <span class="math inline">\(N^{-1/2}\)</span> that of the mean energy.</p>
</section>
<section id="density-fluctuation-in-the-canonical-ensemble" class="level3">
<h3 class="anchored" data-anchor-id="density-fluctuation-in-the-canonical-ensemble">Density fluctuation in the canonical ensemble</h3>
<p>TODO sethna section 6.7</p>
</section>
</section>
<section id="maximum-caliber-statistical-mechanics" class="level2">
<h2 class="anchored" data-anchor-id="maximum-caliber-statistical-mechanics">Maximum caliber statistical mechanics</h2>
<p><span class="citation" data-cites="ghoshTeachingPrinciplesStatistical2006 ghoshMaximumCaliberVariational2020">(<a href="#ref-ghoshTeachingPrinciplesStatistical2006" role="doc-biblioref">Ghosh et al. 2006</a>; <a href="#ref-ghoshMaximumCaliberVariational2020" role="doc-biblioref">Ghosh et al. 2020</a>)</span></p>
<p>In general, maximal caliber statistical mechanics is like maximal entropy statistical mechanics. You write down a formula for path-space entropy, and a constraint on allowed paths. Maximize the entropy under constraint, and you would obtain a Boltzmann distribution in path space.</p>
<section id="markov-chains" class="level3">
<h3 class="anchored" data-anchor-id="markov-chains">Markov chains</h3>
<p>SETUP.</p>
<p><span class="math inline">\(N\)</span> timesteps in total.</p>
<p><span class="math inline">\(s_t\)</span> is the state of timestep <span class="math inline">\(t\)</span>.</p>
<p>There are <span class="math inline">\(m\)</span> states in total.</p>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 4</strong></span> If we fix the singleton probability <span class="math inline">\(p_i\)</span> of each state, then the maximum entropy distribution is the Markov chain with uniform initial probability and <span class="math inline">\(p_{i\to j} = p_i p_j\)</span>.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>By Lagrange multipliers.</p>
<p>If we fix the singleton probability of each state, then the problem is a constrained maximization problem</p>
<p><span class="math display">\[
\begin{cases}
    \max S \\
    \frac 1N \sum_t 1[s_t = k] = p_k, \quad \forall k = 1, \dots, m
\end{cases}
\]</span></p>
<p>This is the same problem as <span class="math inline">\(N\)</span> balls in a certain constrained microcanonical ensemble. When <span class="math inline">\(N\)</span> is large enough, the discrete “macrostate” <span class="math inline">\(\frac 1N \sum_t 1[s_t = k]\)</span> becomes continuous, and we can use the Lagrange multiplier to obtain <span class="math display">\[\rho(s_1, \dots, s_N) = \frac 1Z e^{-\sum_{k=1}^m \lambda_k (\frac 1N \sum_{t=1}^N 1[s_t =k] - p_k)}\]</span></p>
<p>This factors over time <span class="math inline">\(t\)</span>, giving us <span class="math display">\[\rho(s_1, \dots, s_N) = \prod_{t=1}^N \rho(s_t)\]</span></p>
<p>with<br>
<span class="math display">\[\rho(s_t=k) \propto e^{-\sum_{k=1}^m\frac{\lambda_k}{N}(1[s_t =k] - p_k)} \propto e^{-\frac{\lambda_k}{N}}\]</span></p>
<p>The multiplier <span class="math inline">\(\lambda_k\)</span> can be found by the typical method of solving <span class="math inline">\(p_k = -\partial_{\lambda_k}\ln Z\)</span>, or we can take the shortcut and notice that <span class="math inline">\(\rho(s_t=k) = p_k\)</span>, and be done with it.</p>
</div>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5</strong></span> If we fix the transition probability <span class="math inline">\(p_{i \to j}\)</span> of each state-pair, then the maximum entropy distribution is the Markov chain with uniform initial probability. If we fix the initial probability, then it’s still the Markov chain with the same transition probabilities.</p>
<p>And more generally, if we fix <span class="math inline">\(n\)</span>-th order transition probability <span class="math inline">\(p_{i_1, \dots, i_n \to j}\)</span>, then we obtain an <span class="math inline">\(n\)</span>-th order Markov chain model.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Similarly as above, the path-space distribution is <span class="math display">\[\rho(s_1, \dots, s_N) \propto \prod_{t=1}^{N-1} e^{-\sum_{k, k' \in 1:m} \frac{\lambda_{k, k'}}{N} 1[s_t = k, s_{t+1} = k']} \propto \prod_{t=1}^{N-1} p_{s_t \to s_{t+1}}\]</span></p>
<p>Because the distribution does not specify <span class="math inline">\(s_1\)</span>, it is uniformly distributed on <span class="math inline">\(s_1\)</span>. Otherwise, we can constrain <span class="math inline">\(s_1\)</span> with yet another set of Lagrange multipliers and obtain <span class="math inline">\(\rho(s_1, \dots, s_N) \propto \rho(s_1) \times_{t=1}^{N-1} \rho(s_t, s_{t+1})\)</span>. Similarly for higher orders.</p>
</div>
</section>
<section id="diffusion" class="level3">
<h3 class="anchored" data-anchor-id="diffusion">diffusion</h3>
<p>The path-space entropy</p>
<p><span class="math display">\[
S = - \int \rho(x) \ln \rho(x) D[x]
\]</span></p>
<p>where <span class="math inline">\(D[x]\)</span> means we integrate over path space, and <span class="math inline">\(x: [0, T] \to \mathbb{R}^n\)</span> is a path.</p>
<p>We discretize the path into <span class="math inline">\(x: \{0, 1, 2, \dots, N\} \to \mathbb{R}^n\)</span>, then because we can decompose</p>
<p><span class="math display">\[
\rho(x) = \rho(x_0) \rho(x_1 | x_0) \cdots \rho(x_N | x_{0:N-1})
\]</span></p>
<p>the path-space entropy decomposes sequentially:</p>
<p><span class="math display">\[
S = S[x_0] + E[S[x_1 | x_0]] + E[S[x_2 | x_{0:1}]] + \dots + E[S[x_N | x_{0:N-1}]]
\]</span></p>
<p>To prevent the entropy from diverging, we need to impose some constraints. If we constrain the second moment of each step, as</p>
<p><span class="math display">\[(E[x_t|x_{0:t-1}], E[x_t^2|x_{0:t-1}]) = (0, \sigma^2), \quad \forall t \in 0:N\]</span></p>
<p>by reasoning backwards from <span class="math inline">\(t = N\)</span> to <span class="math inline">\(t=0\)</span>, we find that the maximal entropy distribution is a white noise:</p>
<p><span class="math display">\[
\rho(x) = \prod_{t\in 0:N} \rho(x_t), \quad \rho(x_t) \propto e^{-\frac{\|x_t\|^2}{2\sigma^2}}
\]</span></p>
<p>If you have studied dynamic programming and cybernetics, this should look very similar to the argument by which you derived the <a href="https://en.wikipedia.org/wiki/Linear-quadratic_regulator">LQR</a>.</p>
<p>To keep the path from exploding into white noise, we instead impose the constraints on the step sizes</p>
<p><span class="math display">\[(E[x_t - x_{t-1}|x_{0:t-1}], E[\|x_t - x_{t-1}\|^2|x_{0:t-1}]) = (0, \sigma^2), \quad \forall t \in 1:N\]</span></p>
<p>and <span class="math inline">\(x_0 = 0\)</span>.</p>
<p>Now, as in dynamical programming, we can reason backwards from <span class="math inline">\(t = N\)</span> to <span class="math inline">\(t=0\)</span>, and we find that the maximal entropy distribution is the Brownian motion</p>
<p><span class="math display">\[\rho(x) \propto e^{-\frac{\sum_{t\in 1:N} \| x_t-x_{t-1}\|^2}{2\sigma^2}}\]</span></p>
<p>If we constrain the first <em>and</em> second moments of each step, and allow them to be affected by the previous step, as in</p>
<p><span class="math display">\[
\begin{cases}
    E[x_t - x_{t-1}|x_{0:t-1}] &amp;= \mu(t, x_{t-1}) \\
    E[(x_t - x_{t-1}) (x_t - x_{t-1})^T|x_{0:t-1}] &amp;= \Sigma(t, x_{t-1})
\end{cases}, \quad \forall t \in 1:N
\]</span></p>
<p>then, reasoning backwards as before, we would obtain the <a href="https://en.wikipedia.org/wiki/Fokker-Planck_equation">Fokker–Planck equation</a>.</p>
<p>Other results, such as the Green-Kubo relation, the Onsager reciprocal relations, etc, can be similarly derived by imposing the right constraints in path space. <span class="citation" data-cites="hazoglouCommunicationMaximumCaliber2015">(<a href="#ref-hazoglouCommunicationMaximumCaliber2015" role="doc-biblioref">Hazoglou et al. 2015</a>)</span></p>
</section>
<section id="fluctuation-dissipation-relations" class="level3">
<h3 class="anchored" data-anchor-id="fluctuation-dissipation-relations">Fluctuation-dissipation relations</h3>
<p>Imagine if you have a weird liquid. You put a piece of pollen into it, and watch it undergo Brownian motion. Now I flip a switch and suddenly all friction disappears from the liquid. What would happen? The pollen is still being hit by random pieces of molecules, so its velocity is still getting pushed this and that way. However, without friction, the velocity at time <span class="math inline">\(t\)</span> is now obtained by integrating all past impulses, with no dissipation whatsoever. Consequently, its velocity undergoes a random walk, and its position undergoes <span class="math inline">\(\int_0^t W_s ds\)</span>, This is very different from what we actually observe, which is that its position undergoes a random walk, not a time-integral of it.</p>
<p>In order to reproduce the actual observed behavior, each fluctuation of its velocity must be quickly dissipated by friction, in a perfect balance such that <span class="math inline">\(\frac 12 m \braket{v^2} = k_BT\)</span> exactly. This perfect conspiracy is the fluctuation-dissipation theorem.</p>
<p>SETUP. Now we set up a one-dimensional fluctuation-dissipation problem.</p>
<p>We have a particle in a sticky fluid, moving on the number line. The particle starts at <span class="math inline">\(x = 0, t = 0\)</span>, and at each time-step of <span class="math inline">\(\Delta t\)</span>, it moves by <span class="math inline">\(\Delta x\)</span> to the left or the right. We define <span class="math inline">\(D = \frac{\Delta x^2}{\Delta t}\)</span> to be the “diffusion constant”.</p>
<p>The fluid is at temperature <span class="math inline">\(\beta^{-1}\)</span>, and we pull on the particle at constant force <span class="math inline">\(F\)</span>. We expect that <span class="math inline">\(F = \gamma \braket{v}\)</span>, where <span class="math inline">\(v\)</span> is the ensemble-average velocity of the particle, and <span class="math inline">\(\gamma\)</span> is the viscosity constant.</p>
<p>Now, we let the particle move for a time <span class="math inline">\(t = N\Delta t\)</span>, where <span class="math inline">\(N\)</span> is a large number. The particle would have arrived at some point <span class="math inline">\(x\)</span>, which is a random variable. The particle’s time-averaged velocity is <span class="math inline">\(v = x/t\)</span>.</p>
<p>DER.</p>
<p>The number of possible paths that connect <span class="math inline">\((0, 0)\)</span> with <span class="math inline">\((t, x)\)</span> is <span class="math inline">\(\binom{N}{\frac N2 - \frac{x}{2\Delta x}}\)</span>, therefore, the path-space entropy is</p>
<p><span class="math display">\[S_{path} = \ln \binom{N}{\frac N2 - \frac{x}{2\Delta x}}\]</span></p>
<p>Because the external force performs work <span class="math inline">\(Fx\)</span>, which is dissipated into the sticky liquid at temperature <span class="math inline">\(\beta\)</span>, we also have</p>
<p><span class="math display">\[S_{work} = \beta Fx\]</span></p>
<p>Because <span class="math inline">\(N\)</span> is large, <span class="math inline">\(\braket{x}\)</span> should be highly concentrated around the point of maximal entropy. That is, we should have</p>
<p><span class="math display">\[
\braket{x} \approx \mathop{\mathrm{argmax}}_x (S_{path} + S_{work})
\]</span></p>
<p>Notice how this is the exact same problem as the case where we have a rubber band. By routine calculation, this simplifies to</p>
<p><span class="math display">\[\braket{x} = \beta FN(\Delta x)^2\]</span></p>
<p>which gives us, after further simplification, the Einstein relation:</p>
<p><span class="math display">\[\beta D \gamma = 1\]</span></p>
</section>
</section>
<section id="crooks-fluctuation-theorem" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="crooks-fluctuation-theorem">Crooks fluctuation theorem</h2>
<section id="in-a-closed-system-microcanonical" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="in-a-closed-system-microcanonical">In a closed system (microcanonical)</h3>
<p>SETUP. The system is a classical-mechanical system, with time-reversible dynamics, and follows Liouville’s theorem.</p>
<p>We have a thermodynamic system held under variable constraints <span class="math inline">\(x\)</span>.</p>
<p>The system starts in microcanonical ensemble of energy <span class="math inline">\(E_1\)</span>. Then we change the constraints <span class="math inline">\(x(t)\)</span>, quickly or slowly, over a time interval <span class="math inline">\(t\in [0, \tau]\)</span>. Let the microstate trajectory of the system be <span class="math inline">\(y(t)\)</span>, arriving at the energy shell of <span class="math inline">\(E_2\)</span>.</p>
<p>During the forward process, if the system undergoes microstate trajectory <span class="math inline">\(y(t)\)</span>, then we have to expend work <span class="math inline">\(W[x(t), y(t)] = E_2 - E_1\)</span>.</p>
<p>Let <span class="math inline">\(S_1^*\)</span> be the maximal entropy of the system when held under the constraints of <span class="math inline">\(x(0)\)</span>, and when the system has energy <span class="math inline">\(E_1\)</span>. Similarly for <span class="math inline">\(S_2^*\)</span>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math inline">\(S_1 = S_1^*\)</span>, since the system starts in thermal equilibrium. However, by Liouville’s theorem, entropy is <em>conserved</em>! So we actually have <span class="math inline">\(S_2 = S_1 \neq S_2^*\)</span>, because the system does not end in thermal equilibrium.</p>
</div>
</div>
<p><span class="math inline">\(x', y'\)</span> are <span class="math inline">\(x, y\)</span> time-reversed.</p>
<p>For example, if we have a piston of gas made of only a few gas molecules, then the constraint is the volume <span class="math inline">\(V\)</span>, and we want to study the probability of expending work <span class="math inline">\(W\)</span> if we give the piston head a push. The push can be slow or fast – arbitrarily far from equilibrium. Crooks theorem applies no matter how we push the piston head.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figure/Crooks_sethna_2021_4_10.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><span class="citation" data-cites="sethnaStatisticalMechanicsEntropy2021">(<a href="#ref-sethnaStatisticalMechanicsEntropy2021" role="doc-biblioref">Sethna 2021, fig. 4.10</a>)</span></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figure/Crooks_sethna_2021_4_11.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><span class="citation" data-cites="sethnaStatisticalMechanicsEntropy2021">(<a href="#ref-sethnaStatisticalMechanicsEntropy2021" role="doc-biblioref">Sethna 2021, fig. 4.11</a>)</span></figcaption>
</figure>
</div>
<p>SETUP. probability density over path-space.</p>
<p>Let <span class="math inline">\(\delta E_1, \delta E_2\)</span> be infinitesimals, and let <span class="math inline">\(E_1, E_2\)</span> be real numbers.</p>
<p>Given a small bundle of microtrajectories <span class="math inline">\(y\)</span>, we can measure its path-space volume as <span class="math inline">\(D[y]\)</span>. Suppose they start on the energy shell <span class="math inline">\([E_1, E_1 + \delta E_1]\)</span>, then they would end up <em>somewhere</em>. If we’re lucky, they would end up on the energy shell <span class="math inline">\([E_2 + \delta E_2]\)</span>.</p>
<p>Suppose the system starts in the microcanonical ensemble on the energy shell <span class="math inline">\([E_1, E_1 + \delta E_1]\)</span>, and we perform the constraint-variation <span class="math inline">\(x\)</span>, then there is a certain probability <span class="math inline">\(\delta P\)</span> that we would sample a trajectory from the small bundle. That small probability is <span class="math display">\[\rho(y | x) D[y]\]</span></p>
<p>where <span class="math inline">\(\rho(y | x)\)</span> is a probability density over path-space. In particular, <span class="math inline">\(\rho(y | x) = 0\)</span> identically, unless <span class="math inline">\(y(0)\)</span> is on the energy shell <span class="math inline">\([E_1, E_1 + \delta E_1]\)</span>.</p>
<p>Running the argument backwards, we can define <span class="math inline">\(\rho'(y' | x')\)</span>, another probability density over paths. This one satisfies <span class="math inline">\(\rho'(y'| x') = 0\)</span> unless <span class="math inline">\(y'(0)\)</span> is on the energy shell <span class="math inline">\([E_2, E_2 + \delta E_2]\)</span>.</p>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 6 (Crooks fluctuation theorem (microcanonical))</strong></span> For any trajectory <span class="math inline">\(y\)</span> such that it starts on the <span class="math inline">\([E_1, E_1 + \delta E_1]\)</span> energy shell, and ends on the <span class="math inline">\([E_2, E_2 + \delta E_2]\)</span> energy shell,</p>
<p><span class="math display">\[\frac{\rho(y | x)}{\rho'(y' | x')} = e^{\Delta S}\]</span></p>
<p>where <span class="math inline">\(\Delta S= \ln\Omega_2 - \ln\Omega_1\)</span>, <span class="math inline">\(\Omega_1\)</span> is the phase space volume of the first energy shell, and <span class="math inline">\(\Omega_2\)</span> the second.</p>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If <span class="math inline">\(y\)</span> does not start on the first energy shell, or does not end on the second energy shell, then either the nominator or the denominator is zero, and so the equation fails to hold.</p>
</div>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>In the forward process, the probability of going along that trajectory is <span class="math display">\[\rho(x|y) D[x] = \frac{\delta V}{\Omega_1}\]</span></p>
<p>where <span class="math inline">\(\delta V\)</span> is the phase-space volume of the shaded set.</p>
<p>In the backward process, the probability of reversing that trajectory is <span class="math display">\[\rho'(x'|y') D[x']= \frac{\delta V'}{\Omega_2}\]</span></p>
<p><span class="math inline">\(\delta V' = \delta V\)</span> by Liouville’s theorem, and <span class="math inline">\(D[x] = D[x']\)</span> because <span class="math inline">\(x'\)</span> is just <span class="math inline">\(x\)</span> time-reversed.</p>
</div>
</section>
<section id="in-an-energy-bath-canonical" class="level3">
<h3 class="anchored" data-anchor-id="in-an-energy-bath-canonical">In an energy bath (canonical)</h3>
<p>Now, suppose we take the same piston of gas, and put it in energy-contact with an energy bath, then at thermal equilibrium, the piston of gas would have the Boltzmann distribution <span class="math inline">\(\propto e^{-\beta E}\)</span>. We can then give the piston head a push, which would cause it to undergo</p>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 7 (Crooks fluctuation theorem)</strong></span> <span class="math display">\[\frac{\rho(y | x)}{\rho'(y' | x')} =  e^{S[x, y]} = e^{\beta (W[x, y] - \Delta F^*)}\]</span></p>
<p>where <span class="math inline">\(S[x, y]\)</span> is the entropy produced during the forward process, after the system has equilibrated, and <span class="math inline">\(\Delta F^* = F^*_2 - F^*_2\)</span> is the increase in <em>equilibrium</em> Helmholtz free energy of the system.</p>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>In both forward and backward cases, we start with a thermal equilibrium, and end with a thermal <em>dis</em>equilibrium.</p>
<p>For example, suppose we have a small tank of a few gas molecules in thermal equilibrium with a large energy bath.</p>
<p>Now, we <em>quicky</em> push the piston head in according to the function <span class="math inline">\(x(t)\)</span>. The trajectory of the system would go through is <span class="math inline">\(y(t)\)</span>, which is <em>determined</em> by both <span class="math inline">\(x(t)\)</span> and the initial state of both the system and the energy bath.</p>
<p>Now, we <em>wait a long time</em>, until the tank is in thermal equilibrium again. Then we pull the piston head out with time-reversed trajectory. Because the forward trajectory was quick, the backward trajectory was also quick.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="equilibrium Helmholtz">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
equilibrium Helmholtz
</div>
</div>
<div class="callout-body-container callout-body">
<p>We wrote <span class="math inline">\(F^*\)</span> instead of <span class="math inline">\(F\)</span>, to emphasize that we are dealing with <em>equilibrium</em> Helmholtz free energy, defined by <span class="math inline">\(F^* = \min_\rho (\braket{E} - TS[\rho])\)</span>, and <em>not</em> the generic version <span class="math inline">\(\braket{E} - TS[\rho]\)</span>.</p>
<p>This is vitally important, because at time <span class="math inline">\(\tau\)</span>, when the constraints have just reached their new values, the system is <em>not</em> in equilibrium. We would have to hold the constraints constant for a while for the system to return to equilibrium with the energy bath. Despite this, Crooks fluctuation theorem uses <span class="math inline">\(\Delta F^*\)</span>, which is computed at equilibrium.</p>
</div>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Apply the microcanonical version of Crooks theorem to the entire compound system that includes both the bath and the system, then integrate over all possible microstate trajectories of the bath <span class="math inline">\(y_{bath}\)</span>.</p>
<p><span class="math display">\[\begin{aligned}
  S[x, y] &amp;= \Delta S_{bath} + \Delta S_{system} \\
  &amp;= \beta \Delta E_{bath} + \Delta S_{system} \\
  &amp;= \beta(W[x, y] - \braket{\Delta E_{system}}_2) + \Delta S_{system} \\
  &amp;= \beta (W[x, y] - \Delta F^*)
\end{aligned}\]</span></p>
<p>where <span class="math inline">\(\braket{\cdot}_2\)</span> means the canonical ensemble average under constraint <span class="math inline">\(x(\tau)\)</span>.</p>
<p>Notice that the work expended/entropy produced depends only on the system’s microtrajectory <span class="math inline">\(y(t)\)</span>, and <em>not</em> on the bath’s microtrajectory <span class="math inline">\(y_{bath}(t)\)</span>. That is,</p>
<p><span class="math display">\[S[x, y, y_{bath}] = S[x, y]\]</span></p>
<p>This will be used again in the next step when we integrate over <span class="math inline">\(D[y_{bath}]\)</span>.</p>
<p><span class="math display">\[\begin{aligned}
  \rho(y|x) &amp;= \int_{y, y_{bath}, x \text{ is valid}}D[y_{bath}]\; \rho(y, y_{bath} | x)  \\
  &amp;=  \underbrace{\int_{y', y'_{bath}, x' \text{ is valid}}D[y'_{bath}]}_{\text{reversible dynamics}}\; \underbrace{e^{S[x, y, y_{bath}]}\rho'(y', y'_{bath} | x')}_{\text{microcanonical Crooks}}  \\
  &amp;=  \int D[y'_{bath}] \; e^{\red{S[x, y]}}\rho'(y', y'_{bath} | x') \\
  &amp;=  e^{S[x,y]} \int D[y'_{bath}] \; \rho'(y', y'_{bath} | x') \\
  &amp;=  e^{S[x,y]} \rho'(y'|x')
\end{aligned}\]</span></p>
</div>
<div id="cor-todo" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 2</strong></span> <span class="math display">\[\frac{\rho(W | x)}{\rho'(-W | x')} =  e^{\beta (W - \Delta F^*)}\]</span></p>
<p>where <span class="math inline">\(\rho(W|x)\)</span> is the probability density of expending work <span class="math inline">\(W\)</span> in the forward process.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Integrate over all forward microtrajectories <span class="math inline">\(y\)</span> satisfying <span class="math inline">\(W[x, y] \in [W, W+\delta W]\)</span>. By reversibility, <span class="math inline">\(W[x', y'] = [-W - \delta W, -W]\)</span> for such microtrajectories.</p>
</div>
</section>
<section id="other-ensembles" class="level3">
<h3 class="anchored" data-anchor-id="other-ensembles">Other ensembles</h3>
<p>Looking at the proof for Crooks theorem for the canonical ensemble, we immediately obtain many other possible Crooks theorems, one per free entropy.</p>
<p>EXP. Crooks theorem for Gibbs free energy <span class="math inline">\(G\)</span></p>
<p>Suppose we have a piston of magnetic gas in energy-and-volume contact with a bath. Now suppose the gas is in equilibrium with the bath, and we vary the external magnetic field over a trajectory <span class="math inline">\(x\)</span>. Over the microstate trajectory <span class="math inline">\(x\)</span>, the external world would expend both some energy <span class="math inline">\(W[x, y]\)</span> and some volume <span class="math inline">\(V[x, y]\)</span>.</p>
<p><span class="math display">\[\frac{\rho(y | x)}{\rho'(y' | x')} =  e^{S[x, y]} = e^{\beta (W[x, y] + PV[x, y] - \Delta G^*)}\]</span></p>
<p>EXP. Crooks theorem for Landau free energy <span class="math inline">\(\Omega\)</span></p>
<p>Suppose we have a chemical reaction chamber of fixed volume, and in energy-and-particle contact with a bath with chemical potentials <span class="math inline">\(\mu_i\)</span>.</p>
<p><span class="math display">\[\frac{\rho(y | x)}{\rho'(y' | x')} =  e^{S[x, y]} = e^{\beta (W[x, y] -  \sum_i \mu_i N_i[x, y] - \Delta \Omega^*)}\]</span></p>
</section>
</section>
<section id="jarzynski-equality" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="jarzynski-equality">Jarzynski equality</h2>
<p>Let <span class="math inline">\(W\)</span> be the total work we expended by changing the constraints during the interval <span class="math inline">\([0, \tau]\)</span>. Since the work expended depends on the details of the heat bath and the starting state of the system at <span class="math inline">\(t=0\)</span>, this is a random variable.</p>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8 (Jarzynski equality)</strong></span> <span class="math display">\[\braket{e^{-\beta W}} = e^{-\beta \Delta F^*}\]</span></p>
<p>where the expectation is taken over many repeats of the same experiment (ensemble average).</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Integrate Crooks over all forward trajectories <span class="math inline">\(D[x]\)</span>.</p>
<p><span class="math display">\[\rho(y | x) e^{-\beta W[x, y] } = \rho'(y' | x') e^{-\beta\Delta F}\]</span></p>
<p>now integrate over <span class="math inline">\(\int D[y]\)</span>, using the fact that <span class="math inline">\(D[y] = D[y']\)</span>.</p>
</div>
<div id="cor-todo" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 3 (violation of second law is exponentially unlikely)</strong></span> <span class="math display">\[Pr((W - \Delta F^*) \leq - \delta W) \leq e^{-\beta \delta W}\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Apply Markov’s inequality.</p>
</div>
<p>EXP. high probability of work extraction</p>
<p>Classically, if we have a single system in thermal equilibrium with a single energy-bath, and we perform a cyclic operation on it, then we can’t extract work, lest we violate the second law.</p>
<p>Statistically, <span class="math inline">\(\braket{e^{-\beta W}} = 1\)</span>, and so it is entirely possible for us to extract work with high probability, as long as there is a small probability to lose a large enough amount of work.</p>
<p><span class="citation" data-cites="mailletOptimalProbabilisticWork2019">(<a href="#ref-mailletOptimalProbabilisticWork2019" role="doc-biblioref">Maillet et al. 2019</a>)</span> constructed a quantum mechanical device with a single-electron transistor. The electron can expend work. They managed to extract work from the device with over 75% probability.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figure/maillet_2019_3_c.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Figure from <span class="citation" data-cites="mailletOptimalProbabilisticWork2019">(<a href="#ref-mailletOptimalProbabilisticWork2019" role="doc-biblioref">Maillet et al. 2019, fig. 3.c</a>)</span></figcaption>
</figure>
</div>
<section id="worked-example-bouncing-ball" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="worked-example-bouncing-ball">Worked example: bouncing ball</h3>
<p>This example is from <span class="citation" data-cites="sethnaStatisticalMechanicsEntropy2021">(<a href="#ref-sethnaStatisticalMechanicsEntropy2021" role="doc-biblioref">Sethna 2021</a>, exercise 4.8)</span>, which itself derives from <span class="citation" data-cites="luaPracticalApplicabilityJarzynski2005">(<a href="#ref-luaPracticalApplicabilityJarzynski2005" role="doc-biblioref">Lua and Grosberg 2005</a>)</span>. See also <span class="citation" data-cites="hijarJarzynskiEqualityIllustrated2010">(<a href="#ref-hijarJarzynskiEqualityIllustrated2010" role="doc-biblioref">Híjar and de Zárate 2010</a>)</span> for another solved example, of a chest expander with mass points stuck in the middle of the springs. You might need to read my post on <a href="https://yuxi-liu-wired.github.io/sketches/posts/field-theory-how-to/">field-theoretic calculations</a> before attempting that example.</p>
<p>We have a one-dimensional system, of a single ball bounding between two walls of a piston. The only control we have is that we can move one of the piston heads. At the start, the piston has length <span class="math inline">\(L\)</span>, and the system is in thermal equilibrium at inverse temperature <span class="math inline">\(\beta\)</span>. We plunge the piston head at velocity <span class="math inline">\(v\)</span> for time <span class="math inline">\(\Delta L / v\)</span>, then immediately reverse it, taking another <span class="math inline">\(\Delta L / v\)</span>. We explicitly calculate that <span class="math inline">\(\braket{e^{-\beta W}} = 1\)</span>.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figure/Jarzynski_bouncing_ball_sethna_2021_4_12.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><span class="citation" data-cites="sethnaStatisticalMechanicsEntropy2021">(<a href="#ref-sethnaStatisticalMechanicsEntropy2021" role="doc-biblioref">Sethna 2021, fig. 4.12</a>)</span></figcaption>
</figure>
</div>
<p>The phase space of the ball has 2 dimensions, <span class="math inline">\((p, x)\)</span>. The Boltzmann distribution is</p>
<p><span class="math display">\[\rho(p, x) = \rho(p) \rho(x) = \frac{1}{\sqrt{2\pi m/\beta}}e^{-\frac{\beta}{2m}p^2} \times \frac{1}{L}\]</span></p>
<p>We assume that <span class="math inline">\(L\)</span> is large enough, such that the ball hits the piston head at most once. There are three possibilities:</p>
<ol type="1">
<li>If the piston head hits the ball during the in-stroke, then the ball’s velocity increases by <span class="math inline">\(2v\)</span>, and its kinetic energy increases by <span class="math display">\[W = \Delta KE = 2v(mv - p)\]</span></li>
<li>If the piston head hits the ball during the out-stroke, then the ball’s velocity decreases by <span class="math inline">\(2v\)</span>, and its kinetic energy increases by<br>
<span class="math display">\[W = 2v(mv+p)\]</span></li>
<li>Otherwise, the piston head avoids the ball, and we have <span class="math inline">\(W = 0\)</span>.</li>
</ol>
<p>If at <span class="math inline">\(t=0\)</span>, the ball is in the phase space region labelled “in region”, then it will be hit in the in-stroke. If at <span class="math inline">\(t=\Delta L/v\)</span>, the ball is in the phase space region labelled “out region”, then it will be hit in the out-stroke. Otherwise, it will not be hit.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figure/Jarzynski_bouncing_ball_1.jpg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Jarzynski_bouncing_ball_1.jpg</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="figure/Jarzynski_bouncing_ball_2.jpg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Jarzynski_bouncing_ball_2.jpg</figcaption>
</figure>
</div>
<p>Therefore,</p>
<p><span class="math display">\[
\begin{aligned}
    \braket{e^{-\beta W}} &amp;= \int_{in} \rho dpdx \; e^{-\beta 2v(mv-p)} + \int_{out} \rho dpdx \; e^{-\beta 2v(mv+p)} + \int_{other} \rho dpdx \; 1 \\
    &amp;= e^{-2\beta mv^2} \left(\int_{in} \rho dpdx \; e^{2\beta vp} + \int_{out} \rho dpdx \; e^{-2\beta vp}\right) +  \int_{other} \rho dpdx \; 1
\end{aligned}
\]</span></p>
<p>Since <span class="math inline">\(\rho(p, x) = \rho(-p, x - \Delta L)\)</span>, the first two integrals can be combined by flipping the “out region”, then moving it by <span class="math inline">\(\Delta L\)</span>, to “out’ region”.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Because <span class="math inline">\(L\)</span> is large, this is <em>mostly</em> correct, as the regions where this is incorrect has <span class="math inline">\(\rho\)</span> so small that it is negligible, as seen in the figure.</p>
</div>
</div>
<p>Now we continue:</p>
<p><span class="math display">\[
\begin{aligned}
\braket{e^{-\beta W}} &amp;\approx e^{-2\beta mv^2} \int_{in, out'} \rho dpdx \; e^{2\beta vp} +  \int_{other} \rho dpdx \; 1 \\
&amp;= \frac{1}{L\sqrt{2\pi m/\beta}} \left(\int_{in, out'} e^{-\frac{\beta}{2m}(p - 2mv)^2} dpdx + \int_{other} e^{-\frac{\beta}{2m}p^2} dpdx\right)
\end{aligned}
\]</span></p>
<p>Because the “in-out’ region” is symmetric across the <span class="math inline">\(p = mv\)</span> line, we can reflect the first integral across the <span class="math inline">\(p=mv\)</span> line and obtain <span class="math display">\[
= \frac{1}{L\sqrt{2\pi m/\beta}} \left(\int_{in, out'} e^{-\frac{\beta}{2m}p^2} dpdx + \int_{other} e^{-\frac{\beta}{2m}p^2} dpdx\right) = 1
\]</span></p>
</section>
<section id="fluctuation-dissipation-relations-1" class="level3">
<h3 class="anchored" data-anchor-id="fluctuation-dissipation-relations-1">Fluctuation-dissipation relations</h3>
<div id="cor-todo" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 4 (Fluctuation-dissipation relations)</strong></span> Since <span class="math inline">\(e^t\)</span> is convex, we have <span class="math inline">\(\Delta F^* \leq \braket{W}\)</span>, meaning that the average work expended is more than the increase in Helmholtz free energy. This has better be true, else we would be violating the second law of thermodynamics on average.</p>
<p>Since <span class="math inline">\(\Delta F^* = -\frac{1}{\beta} \ln\braket{e^{-\beta W}}\)</span>, we find that to second order, <span class="math display">\[\underbrace{\braket{W} - \Delta F^*}_{\text{work dissipation}} = \frac 12 \beta \underbrace{\sigma_W^2}_{\text{work fluctuation}}\]</span></p>
<p>It is more familiarly written as <span class="math display">\[\mu = D\beta\]</span></p>
<p>where <span class="math inline">\(D = \frac 12 \sigma_W^2\)</span> is the fluctuation coefficient, and <span class="math inline">\(\mu = (\braket{W} - \Delta F^*)\)</span> is the dissipation coefficient.</p>
</div>
<div id="thm-todo" class="theorem">
<p><span class="theorem-title"><strong>Theorem 9 (Gallavotti–Cohen fluctuation theorem)</strong></span> A system in an energy bath, and driven by periodically varying its constraints (such as a pendulum in a sticky fluid subjected to a driving force), will settle into a “dynamical equilibrium” ensemble, much like a canonical ensemble.</p>
<p>If it is driven by the same process time-reversed, then, it will settle into another dynamical equilibrium ensemble.</p>
<p><span class="math display">\[\frac{\rho(S)}{\rho'(-S)} = e^{S}\]</span></p>
<p>where <span class="math inline">\(\rho(S)\)</span> is the probability density for a forward cycle producing entropy <span class="math inline">\(S\)</span>, and <span class="math inline">\(\rho'(S)\)</span> is for the backward cycle.</p>
<p>More generally, since at the dynamical equilibrium, the system’s microstates are changing as a Markov chain, we have <span class="math inline">\(\rho(i \to j)\)</span>, which are basically <span class="math display">\[\frac{\rho(i\to j)}{\rho'(j \to i)} = e^{S[i \to j]}\]</span></p>
<p>where <span class="math inline">\(i, j\)</span> are microstates.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>(sketch)</p>
<p>Construct a process that starts at equilibrium, then mount up the periodic driving, runs it for <span class="math inline">\(NT\)</span> time where <span class="math inline">\(N\)</span> is a large integer, then remove the driving. At the <span class="math inline">\(N\to\infty\)</span> limit, the CFT reduces to the theorem.</p>
</div>
</section>
<section id="arrow-of-time" class="level3">
<h3 class="anchored" data-anchor-id="arrow-of-time">Arrow of time</h3>
<p><span class="citation" data-cites="jarzynskiEqualitiesInequalitiesIrreversibility2011">(<a href="#ref-jarzynskiEqualitiesInequalitiesIrreversibility2011" role="doc-biblioref">Jarzynski 2011</a>)</span></p>
<p>Suppose a scientist has recorded a microscopic movie of pulling on an RNA, flipped a coin to decide whether to reverse the movie, then given you the movie. Your task is to guess whether the movie is reversed.</p>
<p>By Bayes theorem, <span class="math display">\[Pr(\text{forward}|x, y) = \frac{1}{1 + e^{-S[x, y]}}\]</span></p>
<p>where <span class="math inline">\(S[x, y] = \beta(W[x, y] - \Delta F^*)\)</span>.</p>
<p>In words, the higher the entropy production, the more likely it is that the movie is playing forward. This is one way to say that entropy production provides an arrow of time.</p>
<p><span class="citation" data-cites="parrondoThermodynamicsInformation2015">(<a href="#ref-parrondoThermodynamicsInformation2015" role="doc-biblioref">Parrondo, Horowitz, and Sagawa 2015</a>)</span></p>
<p><span class="math display">\[\braket{e^{-\beta W - I}} = e^{-\beta \Delta F^*}\]</span></p>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ghoshTeachingPrinciplesStatistical2006" class="csl-entry" role="listitem">
Ghosh, Kingshuk, Ken A. Dill, Mandar M. Inamdar, Effrosyni Seitaridou, and Rob Phillips. 2006. <span>“Teaching the Principles of Statistical Dynamics.”</span> <em>American Journal of Physics</em> 74 (2): 123–33.
</div>
<div id="ref-ghoshMaximumCaliberVariational2020" class="csl-entry" role="listitem">
Ghosh, Kingshuk, Purushottam D. Dixit, Luca Agozzino, and Ken A. Dill. 2020. <span>“The <span>Maximum Caliber Variational Principle</span> for <span>Nonequilibria</span>.”</span> <em>Annual Review of Physical Chemistry</em> 71 (1): 213–38. <a href="https://doi.org/10.1146/annurev-physchem-071119-040206">https://doi.org/10.1146/annurev-physchem-071119-040206</a>.
</div>
<div id="ref-hazoglouCommunicationMaximumCaliber2015" class="csl-entry" role="listitem">
Hazoglou, Michael J., Valentin Walther, Purushottam D. Dixit, and Ken A. Dill. 2015. <span>“Communication: <span>Maximum</span> Caliber Is a General Variational Principle for Nonequilibrium Statistical Mechanics.”</span> <em>The Journal of Chemical Physics</em> 143 (5): 051104. <a href="https://doi.org/10.1063/1.4928193">https://doi.org/10.1063/1.4928193</a>.
</div>
<div id="ref-hijarJarzynskiEqualityIllustrated2010" class="csl-entry" role="listitem">
Híjar, Humberto, and José M. Ortiz de Zárate. 2010. <span>“Jarzynski’s Equality Illustrated by Simple Examples.”</span> <em>European Journal of Physics</em> 31 (5): 1097.
</div>
<div id="ref-jarzynskiEqualitiesInequalitiesIrreversibility2011" class="csl-entry" role="listitem">
Jarzynski, Christopher. 2011. <span>“Equalities and <span>Inequalities</span>: <span>Irreversibility</span> and the <span>Second Law</span> of <span>Thermodynamics</span> at the <span>Nanoscale</span>.”</span> <em>Annual Review of Condensed Matter Physics</em> 2 (Volume 2, 2011): 329–51. <a href="https://doi.org/10.1146/annurev-conmatphys-062910-140506">https://doi.org/10.1146/annurev-conmatphys-062910-140506</a>.
</div>
<div id="ref-luaPracticalApplicabilityJarzynski2005" class="csl-entry" role="listitem">
Lua, Rhonald C., and Alexander Y. Grosberg. 2005. <span>“Practical <span>Applicability</span> of the <span>Jarzynski Relation</span> in <span>Statistical Mechanics</span>:  <span>A Pedagogical Example</span>.”</span> <em>The Journal of Physical Chemistry B</em> 109 (14): 6805–11. <a href="https://doi.org/10.1021/jp0455428">https://doi.org/10.1021/jp0455428</a>.
</div>
<div id="ref-mailletOptimalProbabilisticWork2019" class="csl-entry" role="listitem">
Maillet, Olivier, Paolo A. Erdman, Vasco Cavina, Bibek Bhandari, Elsa T. Mannila, Joonas T. Peltonen, Andrea Mari, et al. 2019. <span>“Optimal <span>Probabilistic Work Extraction</span> Beyond the <span>Free Energy Difference</span> with a <span>Single-Electron Device</span>.”</span> <em>Physical Review Letters</em> 122 (15): 150604. <a href="https://doi.org/10.1103/PhysRevLett.122.150604">https://doi.org/10.1103/PhysRevLett.122.150604</a>.
</div>
<div id="ref-parrondoThermodynamicsInformation2015" class="csl-entry" role="listitem">
Parrondo, Juan M. R., Jordan M. Horowitz, and Takahiro Sagawa. 2015. <span>“Thermodynamics of Information.”</span> <em>Nature Physics</em> 11 (2): 131–39. <a href="https://doi.org/10.1038/nphys3230">https://doi.org/10.1038/nphys3230</a>.
</div>
<div id="ref-sethnaStatisticalMechanicsEntropy2021" class="csl-entry" role="listitem">
Sethna, James P. 2021. <em>Statistical Mechanics: Entropy, Order Parameters, and Complexity</em>. Second Edition. Oxford Master Series in Statistical, Computational, and Theoretical Physics. Oxford, United Kingdom ; New York, NY: Oxford University Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/yuxi-liu-wired\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block">Everything ©<a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block">Yuxi on the Wired</span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block"><a href="../../../sitemap.xml">sitemap</a></span></p>
</div>
  </div>
</footer>




</body></html>